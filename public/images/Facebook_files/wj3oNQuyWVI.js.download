if (self.CavalryLogger) { CavalryLogger.start_js(["YfOwR"]); }

__d('ChatFileUploader.react',['cx','fbt','ChatFileUploaderMixin','InlineBlock.react','MercuryConfig','React','ReactDOM','createCancelableFunction'],(function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=c('React').createClass({displayName:'ChatFileUploader',mixins:[c('ChatFileUploaderMixin')],getDefaultProps:function k(){return {uploaderIsFromHigherLevel:true};},shouldComponentUpdate:function k(){return false;},componentDidMount:function k(){this._uploaderCallback=c('createCancelableFunction')(this.setUpSubscriptionsHandler);this.props.initFileUploaderFn(c('ReactDOM').findDOMNode(this.refs.form),c('ReactDOM').findDOMNode(this.refs.input),c('ReactDOM').findDOMNode(this.refs.attachID)).then(this._uploaderCallback);},componentWillUnmount:function k(){if(this._uploaderCallback)this._uploaderCallback.cancel();},render:function k(){return (c('React').createElement('form',{ref:'form',action:c('MercuryConfig').upload_url,method:'post'},c('React').createElement('input',{type:'hidden',ref:'attachID',name:'attach_id'}),c('React').createElement(c('InlineBlock.react'),{className:"_m _4q60 itemLabel"},c('React').createElement('input',{type:'file',className:"_n",name:'attachment[]',multiple:'true',ref:'input'}),c('React').createElement('span',{className:"_4q61 itemAnchor"},i._("Add Files...")))));}});f.exports=j;}),null);
__d('NotificationSettingsDialog',[],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={show:function i(j){e(['MercuryThreadActions'],function(k){k.get().openNotificationSettings(j);});}};f.exports=h;}),null);
__d('ChatTabMenu.react',['cx','fbt','invariant','Promise','AsyncDialog','AsyncRequest','AutoFocusableLink.react','Bootloader','ChatConfig','ChatFileUploader.react','ChatPrivacyActionController','ChatTabActions','CurrentUser','Dialog','FantaTabActions','MercuryConfig','MercuryIDs','MercuryLogMessageType','MercuryParticipants','MercurySourceType','MercuryThreadMuter','MercuryViewer','MessengerAdminGroupUtils','MessengerPlatformBotReviewWriteDataManager','MNCommerceDialogStateActions','MNCommercePromotionBlockDataManager','MNCommercePromotionManageBlockDialogContainer.react','MNCommerceReviewDialogContainer.react','NFXChatHeadGK','PopoverMenu.react','ReactComponentWithPureRenderMixin','React','ReactDOM','ReactMenu','MercuryMessageObject','MercuryThreadActions','MercuryThreadIDMap','MercuryThreads','MercuryMessageActions','ChangeChatTabColorDialog','EditChatTabNicknamesDialog','MenuSeparator.react','RTCConfig','Toggler','TrackingNodes','URI','WebMessengerDeleteThreadDialog','WebMessengerThreadPermalinks','XNFXStartForMessageThreadController','WorkModeConfig','WorkFileUploadsGating','NotificationSettingsDialog','MessengerNotificationSettingsGKModule','XEventCreateDialogController','XMessagingGroupOptionsDialogController','goURI'],(function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=c('MercuryMessageObject').get(),l=c('MercuryThreadActions').get(),m=c('MercuryThreadIDMap').get(),n=c('MercuryThreads').get(),o=c('MercuryMessageActions').get(),p=c('ReactMenu').Item,q=c('React').PropTypes,r=c('React').createClass({displayName:'ChatTabMenu',_privacyActionController:undefined,_fileUploaderPromise:undefined,_fileUploaderLoader:undefined,_fileUploaderPromiseResolve:undefined,linkRef:undefined,mixins:[c('ReactComponentWithPureRenderMixin')],propTypes:{autoFocus:q.bool,attachmentsShelf:q.object,nameConversationFunc:q.func,isGroupChat:q.bool,isEmptyChat:q.bool,hasMessageBlocked:q.bool,isEmptyConversation:q.bool,onFileUploaderMounted:q.func,onMount:q.func,onSubmit:q.func,onUpdateAttachmentsShelf:q.func,onUploadFinished:q.func,otherUserID:q.string,sheetController:q.object.isRequired,showAddFriend:q.func,threadID:q.string.isRequired},getInitialState:function s(){return {url:null,privacyText:'',muted:false};},getDefaultProps:function s(){return {show:true,isMuted:false,hasSwitchToWork:false};},componentWillMount:function s(){this._fileUploaderPromise=new (c('Promise'))(function(t,u){this._fileUploaderPromiseResolve=t;}.bind(this));},componentDidMount:function s(){c('WebMessengerThreadPermalinks').getThreadURI(this.props.threadID,function(t){this.isMounted()&&this.setState({url:t});}.bind(this));if(!this.props.isGroupChat)this._privacyActionController=new (c('ChatPrivacyActionController'))(c('MercuryIDs').getUserIDFromThreadID(this.props.threadID),function(t){return this._updatePrivacyLink(t);}.bind(this));if(this.props.isMuted)this.props.sheetController.openThreadIsMutedTabSheet();this.props.onMount&&this.props.onMount(this);},componentDidUpdate:function s(t,u){if(this.props.isMuted&&!t.isMuted){this.props.sheetController.openThreadIsMutedTabSheet();}else if(!this.props.isMuted&&t.isMuted)this.props.sheetController.closeThreadIsMutedTabSheet();if(this.props.hasMessageBlocked){this.props.sheetController.openMessageBlockedTabSheet();}else this.props.sheetController.closeMessageBlockedTabSheet();},_initFileUploader:function s(t,u,v){if(this._fileUploaderLoader&&this._fileUploaderPromise){this._fileUploaderPromise.done(function(w){w.updateElements(t,u,v);});}else this._fileUploaderLoader=new (c('Promise'))(function(w,x){c('Bootloader').loadModules(["MercuryFileUploader"],function(y){var z=new y(this.props.attachmentsShelf,t,u,v);this._fileUploaderPromiseResolve&&this._fileUploaderPromiseResolve(z);w(z);}.bind(this),'ChatTabMenu.react');}.bind(this));return this._fileUploaderPromise;},componentWillUnmount:function s(){this._privacyActionController&&this._privacyActionController.destroy();this._fileUploaderPromise&&this._fileUploaderPromise.then(function(t){t.destroy();});},_unmuteThread:function s(){l.unmute(this.props.threadID);c('Toggler').hide();},_togglePrivacyFunc:function s(){this._privacyActionController&&this._privacyActionController.togglePrivacy();},_renderFileUploader:function s(){return (c('React').createElement(p,{className:"_37_x"},c('React').createElement(c('ChatFileUploader.react'),{onFileUploaderMounted:this.props.onFileUploaderMounted,attachmentsShelf:this.props.attachmentsShelf,initFileUploaderFn:this._initFileUploader,onUploadFinished:this.props.onUploadFinished,onUpdateAttachmentsShelf:this.props.onUpdateAttachmentsShelf,onSubmit:this.props.onSubmit})));},_fullConversationRedirect:function s(){if(c('MercuryConfig').WebMessengerDiode&&c('MercuryConfig').WebMessengerDiodeFull){if(c('MercuryConfig').FantaTabs){c('FantaTabActions').closeTab(this.props.threadID);}else c('ChatTabActions').closeTab(this.props.threadID);window.open(this.state.url,'_blank');}else c('goURI')(this.state.url);},_renderOpenFullConversation:function s(){if(this.state.url){var t=c('MercuryConfig').WebMessengerDiode&&c('MercuryConfig').WebMessengerDiodeFull?i._("Open in Messenger"):i._("See Full Conversation");return (c('React').createElement(p,{onclick:this._fullConversationRedirect},t));}return null;},_renderAddFriend:function s(){if(!this.props.showAddFriend)return null;var t=n.getThreadMetaNow(this.props.threadID),u=c('MessengerAdminGroupUtils').isJoinableThread(t),v=void 0;if(c('WorkModeConfig').is_work_user){v=i._("Add colleagues to Chat...");}else if(u){v=i._("Invite friends to Chat...");}else v=i._("Add Friends to Chat...");return (c('React').createElement(p,{onclick:this.props.showAddFriend},v));},_renderTogglePrivacy:function s(){if(!this.props.isGroupChat&&this.state.privacyText)return (c('React').createElement(p,{onclick:this._togglePrivacyFunc},this.state.privacyText));return null;},_renderNotificationSettings:function s(){if(c('MessengerNotificationSettingsGKModule').inGK){var t=c('NotificationSettingsDialog').show.bind(null,this.props.threadID);return (c('React').createElement(p,{onclick:t},i._("Notification Settings")));}return null;},_canEditNickname:function s(){var t=n.getThreadMetaNow(this.props.threadID),u=c('CurrentUser').getID(),v=t&&t.participants&&u&&c('MessengerAdminGroupUtils').canUpdateThreadCustomization(t,u);return !!v;},_renderEditNickname:function s(){if(!this._canEditNickname()||!c('ChatConfig').get('chat_tab_edit_nickname'))return null;return (c('React').createElement(p,{onclick:this._showEditNicknameDialog},i._("Edit Nicknames")));},_renderChangeColor:function s(){var t=n.getThreadMetaNow(this.props.threadID),u=c('MercuryIDs').getUserIDFromParticipantID(c('MercuryViewer').getID()),v=t&&u&&c('MessengerAdminGroupUtils').canUpdateThreadCustomization(t,u);if(v&&c('ChatConfig').get('chat_tab_custom_color'))return (c('React').createElement(p,{onclick:this._showCustomColorDialog},i._("Change Color...")));return null;},_renderMuteConversation:function s(){if(!this.props.isMuted){var t=c('MercuryThreadMuter').showMuteChangeDialog.bind(null,this.props.threadID,this.linkRef);return (c('React').createElement(p,{onclick:t},i._("Mute Conversation...")));}else return (c('React').createElement(p,{onclick:this._unmuteThread},i._("Unmute Conversation")));},_renderDeleteConversation:function s(){return (c('React').createElement(p,{onclick:this._deleteConversation},i._("Delete Conversation...")));},_renderReportSpam:function s(){if(!this.props.isGroupChat&&!c('CurrentUser').isWorkUser())return (c('React').createElement(p,{onclick:this._reportSpamClicked},i._("Report...")));return null;},_manageMessagesItem:function s(){if(c('MercuryConfig').WWWMessengerManageButtonGK&&this.props.isBusinessEnabled)return (c('React').createElement(p,{onclick:this._messageManageClicked},i._("Manage Messages...")));return null;},_manageReviewItem:function s(){if(!this.props.isBusinessEnabled||!c('MercuryConfig').MessengerPlatformBotReviewUsers)return null;return (c('React').createElement(p,{onclick:this._reviewClicked},i._("Leave Feedback")));},_blockMessagesItem:function s(){if(this.props.isBusinessEnabled&&c('MercuryConfig').WWWMessengerManageButtonGK)return null;if(!this.props.isGroupChat&&!this.props.hasMessageBlocked&&!this.props.isEmptyConversation&&!c('CurrentUser').isWorkUser())return (c('React').createElement(p,{onclick:this._messageBlockedClicked},i._("Block Messages...")));if(!this.props.isMultichat&&this.props.hasMessageBlocked)return (c('React').createElement(p,{onclick:this._messageUnblockedClicked},i._("Unblock Messages...")));return null;},_renderCreateGroup:function s(){if(this.props.isGroupChat)return (c('React').createElement(p,{onclick:this._createGroupClicked},i._("Create Group")));return null;},_renderCreateEvent:function s(){if(this.props.isGroupChat)return (c('React').createElement(p,{onclick:this._createEventClicked},i._("Create Event")));return null;},_renderSwitchToWork:function s(){if(this.props.hasSwitchToWork)return (c('React').createElement(p,{onclick:this._switchToWorkUserClicked},i._({"Workplace":"Move to Workplace","Facebook at Work":"Move to Facebook at Work"},[i['enum'](c('WorkModeConfig').use_workplace?'Workplace':'Facebook at Work',{Workplace:'Workplace','Facebook at Work':'Facebook at Work'})])));return null;},_renderConversationName:function s(){var t=n.getThreadMetaNow(this.props.threadID),u=c('MercuryIDs').getUserIDFromParticipantID(c('MercuryViewer').getID()),v=t&&u&&c('MessengerAdminGroupUtils').canUpdateThreadCustomization(t,u)&&this.props.isGroupChat&&this.state.url;if(v)return (c('React').createElement(p,{onclick:this.props.nameConversationFunc},i._("Edit Conversation Name")));return null;},_renderLeaveConversation:function s(){if(this.props.isGroupChat)return (c('React').createElement(p,{onclick:this._unsubscribeLinkClicked},i._("Leave Conversation...")));return null;},_renderEnableDesktopNotifications:function s(){if(c('MercuryConfig').DesktopNotificationsGK&&'Notification' in window&&window.Notification.permission!=='granted')return (c('React').createElement(p,{onclick:this._enableDesktopNotif},i._("Enable Desktop Notifications")));return null;},_renderPeopleList:function s(){if(this.props.isGroupChat&&this.state.url)return (c('React').createElement(p,{onclick:this._showParticipants},i._("Edit Participants...")));return null;},_renderGroupOptions:function s(){var t=n.getThreadMetaNow(this.props.threadID),u=c('MercuryIDs').getUserIDFromParticipantID(c('MercuryViewer').getID());if(t&&u&&this.props.isGroupChat&&c('MessengerAdminGroupUtils').canSeeGroupOptions(true,t,u))return (c('React').createElement(p,{onclick:this._showGroupOptions},i._("View Group Options")));return null;},_renderToggleSecretMode:function s(){if(this.props.hasSecretModeOn)return (c('React').createElement(p,{onclick:this._secretModeTurnOff},i._("Turn off disappearing messages")));return null;},_renderShareScreenContent:function s(){if(c('RTCConfig').CollaborationScreenSharingGK&&!this.props.isGroupChat)return (c('React').createElement(p,{onclick:this._shareScreenContentClicked},i._("Share Screen Content...")));return null;},_shareScreenContentClicked:function s(){c('Bootloader').loadModules(["FBRTCScreenSharingController"],function(t){var u=c('MercuryIDs').getUserIDFromThreadID(this.props.threadID);!!!u?j(0):void 0;var v=new t(parseInt(u,10),null,true);v.initPromise.done(function(){v.initializeAsSender();v.toggleScreenSharing();});}.bind(this),'ChatTabMenu.react');},render:function s(){var t=this._renderReportSpam(),u=this._blockMessagesItem(),v=this._manageMessagesItem(),w=this._manageReviewItem(),x=this._renderCreateGroup(),y=this._renderCreateEvent(),z=this._renderGroupOptions(),aa=c('React').createElement(c('ReactMenu'),{className:"chatReact"+(!this.props.show?' '+"hidden_elem":'')},this._renderOpenFullConversation(),c('WorkFileUploadsGating').canUploadFiles?this._renderFileUploader():null,this._renderToggleSecretMode(),this._renderAddFriend(),this._renderShareScreenContent(),this._renderTogglePrivacy(),this._renderConversationName(),this._renderPeopleList(),c('React').createElement(c('MenuSeparator.react'),null),z,z?c('React').createElement(c('MenuSeparator.react'),null):null,this._renderNotificationSettings(),this._renderEditNickname(),this._renderChangeColor(),this._renderSwitchToWork(),this._renderMuteConversation(),this._renderDeleteConversation(),this._renderLeaveConversation(),t||u||v||w?c('React').createElement(c('MenuSeparator.react'),null):null,u,v,w,t,x||y?c('React').createElement(c('MenuSeparator.react'),null):null,x,y,this._renderEnableDesktopNotifications()),ba=i._("Options"),ca=c('TrackingNodes').getTrackingInfo(c('TrackingNodes').types.DROPDOWN_BUTTON);return (c('React').createElement(c('PopoverMenu.react'),{menu:aa,ref:'menu'},c('React').createElement(c('AutoFocusableLink.react'),{autoFocus:this.props.autoFocus,'data-ft':ca,'data-hover':'tooltip','aria-label':ba,'data-tooltip-alignh':'center','data-tooltip-content':ba,className:"button"+(this.props.isEmptyChat?' '+"hidden_elem":'')+(' '+"_3olv")+(' '+"_1ll-"),ref:function(da){return this.linkRef=c('ReactDOM').findDOMNode(da);}.bind(this),role:'button'})));},getFileUploaderPromise:function s(){return this._fileUploaderPromise;},_updatePrivacyLink:function s(t){var u=void 0;if(t==c('ChatPrivacyActionController').OFFLINE){u=i._("Go online");this.setState({privacyText:u});return;}if(this.props.isGroupChat||this.props.otherUserID===undefined)return;var v='fbid:'.concat(this.props.otherUserID);c('MercuryParticipants').get(v,function(w){if(!w.is_friend){u=null;}else if(t==c('ChatPrivacyActionController').BLOCKED){u=i._("Turn on Chat for {name}",[i.param('name',w.short_name)]);}else u=i._("Turn off Chat for {name}",[i.param('name',w.short_name)]);this.setState({privacyText:u});}.bind(this));},_showEditNicknameDialog:function s(){var t=c('MercuryIDs').getUserIDFromParticipantID(c('MercuryViewer').getID());if(t)c('EditChatTabNicknamesDialog').show(this.props.threadID,t,this.linkRef);},_showCustomColorDialog:function s(){c('ChangeChatTabColorDialog').show(this.props.threadID,this.linkRef);},_showParticipants:function s(){m.getServerIDFromClientID(this.props.threadID,function(t){c('AsyncDialog').send(new (c('AsyncRequest'))(new (c('URI'))('/ajax/browser/dialog/multichat_members/').addQueryData({id:t})));});},_unsubscribeLinkClicked:function s(){var t=[];t.push({name:'unsubscribe',label:i._("Leave Conversation"),handler:function(){return this._unsubscribeToThread();}.bind(this)});t.push(c('Dialog').CANCEL);var u=void 0;n.getThreadMeta(this.props.threadID,function(v){if(v.admin_ids&&v.admin_ids.indexOf(c('MercuryViewer').getID())!==-1){u=i._("Leaving this group will remove you as an owner and allow other members to manage the group. You will no longer be able to send and receive messages.");}else u=i._("You will stop receiving messages from this conversation and people will see that you left.");});new (c('Dialog'))().setTitle(i._("Leave conversation?")).setBody(u).setButtons(t).show();},_unsubscribeToThread:function s(){if(!n.isEmptyLocalThread(this.props.threadID)){var t=k.constructLogMessageObject(c('MercurySourceType').CHAT_WEB,this.props.threadID,c('MercuryLogMessageType').UNSUBSCRIBE,{removed_participants:[c('MercuryViewer').getID()]});o.send(t);}if(c('MercuryConfig').FantaTabs){c('FantaTabActions').closeTab(this.props.threadID);}else c('ChatTabActions').closeTab(this.props.threadID,'unsubscribed');return true;},_deleteConversation:function s(){c('WebMessengerDeleteThreadDialog').show(this.props.threadID,null,this.linkRef);},_reportSpamClicked:function s(){var t=new (c('URI'))('/ajax/chat/report.php').addQueryData({id:this.props.otherUserID}).addQueryData({src:'top_report_link'});if(c('NFXChatHeadGK').result)t=c('XNFXStartForMessageThreadController').getURIBuilder().setString('thread_fbid',this.props.otherUserID).setEnum('location','www_chat_head').getURI();c('AsyncDialog').send(new (c('AsyncRequest'))(t));},_messageBlockedClicked:function s(){l.blockMessages(this.props.threadID);},_messageManageClicked:function s(){var t=function v(w,x){return c('MNCommercePromotionBlockDataManager').block(w,x);},u=c('MercuryIDs').getUserIDFromThreadID(this.props.threadID);c('MNCommerceDialogStateActions').showDialog(c('MNCommercePromotionManageBlockDialogContainer.react'),{pageID:u,onConfirmButtonClick:t});},_reviewClicked:function s(){var t=function v(w,x,y){if(x===0)return;c('MessengerPlatformBotReviewWriteDataManager').review(w,x,y.trim());},u=c('MercuryIDs').getUserIDFromThreadID(this.props.threadID);c('MNCommerceDialogStateActions').showDialog(c('MNCommerceReviewDialogContainer.react'),{pageID:u,onConfirmButtonClick:t});},_messageUnblockedClicked:function s(){l.unblockMessages(this.props.threadID);},_secretModeTurnOff:function s(){l.turnOffSecretMode(this.props.threadID);},_secretModeTurnOn:function s(){l.turnOnSecretMode(this.props.threadID);},_showGroupOptions:function s(){n.getThreadMeta(this.props.threadID,function(t){if(!t.is_canonical){var u=c('XMessagingGroupOptionsDialogController').getURIBuilder().setString('thread_fbid',t.thread_fbid).getURI();c('AsyncDialog').send(new (c('AsyncRequest'))(u));}});},_createGroupClicked:function s(){n.getThreadMeta(this.props.threadID,function(t){if(!t.is_canonical){var u=new (c('URI'))('/ajax/groups/create_get.php').addQueryData({ref:'web_messenger_dock',parent_id:'0'}),v=t.participants.map(function(w){return c('MercuryIDs').getUserIDFromParticipantID(w);}).filter(function(w){return w;});u.addQueryData({members:v});if(t.name)u.addQueryData({name:t.name});c('AsyncDialog').send(new (c('AsyncRequest'))(u));}});},_createEventClicked:function s(){n.getThreadMeta(this.props.threadID,function(t){if(!t.is_canonical){var u=t.participants.map(function(w){return c('MercuryIDs').getUserIDFromParticipantID(w);}).filter(function(w){return w;}),v=c('XEventCreateDialogController').getURIBuilder().setString('acontext',JSON.stringify({})).setIntVector('invite_ids',u).getURI();c('AsyncDialog').send(new (c('AsyncRequest'))(v));}});},_switchToWorkUserClicked:function s(){var t=[];t.push({name:'move',label:i._("Move Conversation"),handler:function(){return this._switchToWork();}.bind(this)});t.push(c('Dialog').CANCEL);var u=void 0,v=void 0;if(c('WorkModeConfig').use_workplace){u=i._("Move conversation to Workplace?");v=i._("Do you want to move this conversation to Workplace?");}else{u=i._("Move Conversation to Work Account?");v=i._("Do you want to move this conversation so that it is shown in your work account instead?");}new (c('Dialog'))().setTitle(u).setBody(v).setButtons(t).show();},_switchToWork:function s(){if(!n.isEmptyLocalThread(this.props.threadID)){var t=k.constructLogMessageObject(c('MercurySourceType').CHAT_WEB,this.props.threadID,c('MercuryLogMessageType').SWITCH_TO_WORK,{removed_participants:[c('MercuryViewer').getID()]});o.send(t);}if(c('MercuryConfig').FantaTabs){c('FantaTabActions').closeTab(this.props.threadID);}else c('ChatTabActions').closeTab(this.props.threadID,'unsubscribed');return true;},_enableDesktopNotif:function s(){b.Notification.requestPermission();},open:function s(){this.refs.menu.showPopover();}});f.exports=r;}),null);